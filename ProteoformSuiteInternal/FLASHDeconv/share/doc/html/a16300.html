<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenMS: InternalCalibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style_ini.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenMS_75x55_transparent.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenMS
   &#160;<span id="projectnumber">2.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="a16239.html">User Quickstart Guide</a></li><li class="navelem"><a class="el" href="a16240.html">TOPP documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">InternalCalibration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Performs an internal mass recalibration on an MS experiment.</p>
<center> <table class="doxtable">
<tr>
<td align="center" bgcolor="#EBEBEB">pot. predecessor tools  </td><td valign="middle" rowspan="3"><img class="formulaInl" alt="$ \longrightarrow $" src="form_34.png"/> InternalCalibration <img class="formulaInl" alt="$ \longrightarrow $" src="form_34.png"/> </td><td align="center" bgcolor="#EBEBEB">pot. successor tools   </td></tr>
<tr>
<td valign="middle" align="center" rowspan="1"><a class="el" href="a16328.html">PeakPickerWavelet</a>  </td><td valign="middle" align="center" rowspan="2">any tool operating on MS peak data <br  />
 (in mzML format)  </td></tr>
<tr>
<td valign="middle" align="center" rowspan="1"><a class="el" href="a16271.html">FeatureFinderCentroided</a>   </td></tr>
</table>
</center><p>Given reference masses (as either peptide identifications or as list of fixed masses) an MS experiment can be recalibrated using a linear or quadratic regression fitted to the observed vs. the theoretical masses.</p>
<p>Chose one of two optional input files: 1) peptide identifications (from featureXML or idXML) using 'id_in' 2) lock masses using 'lock_in'</p>
<p>The user can choose whether the calibration function shall be calculated for each spectrum separately or once for the whole map. If this is done scan-wise, a user-defined range of neighboring spectra is searched for lock masses/peptide IDs. They are used to build a model, which is applied to the spectrum at hand. The RT range ('RT_chunking') should be small enough to resolve time-dependent change of decalibration, but wide enough to have enough calibrant masses for a stable model. A linear model requires at least two calibrants, a quadradic at least three. Usually, the RT range should provide about 3x more calibrants than required, i.e. 6(=3x2) for linear, and 9(=3x3) for quadratic models. If the calibrant data is too sparse for a certain scan, the closest neighboring model will be used automatically. If no model can be calculated anywhere, the tool will fail.</p>
<p>Optional quality control output files allow to judge the success of calibration. It is strongly advised to inspect them. If PNG images are requested, 'R' (statistical programming language) needs to be installed and available on the system path!</p>
<p>Outlier detection is supported using the RANSAC algorithm. However, usually it's better to provide high-confidence calibrants instead of relying on automatic removal of outliers.</p>
<p>Post calibration statistics (median ppm and median-absolute-deviation) are automatically computed. The calibration is deemed successful if the statistics are within certain bounds ('goodness:XXX').</p>
<p>Detailed description for each calibration method: 1) [id_in] The peptide identifications should be derived from the very same mzML file using a wide precursor window (e.g. 25 ppm), which captures the possible decalibration. Subsequently, the IDs should be filtered for high confidence (e.g. low FDR, ideally FDR=0.0) and given as input to this tool. Remaining outliers can be removed by using RANSAC. The data might benefit from a precursor mass correction (e.g. using <a class="el" href="a16290.html">HighResPrecursorMassCorrector</a>), before an MS/MS search is done. The list of calibrants is derived solely from the idXML/featureXML and only the resulting model is applied to the mzML.</p>
<p>2) [lock_in] Calibration can be performed using specific lock masses which occur in most spectra. The structure of the cal:lock_in CSV file is as follows: Each line represents one lock mass in the format: &lt;m/z&gt;, &lt;ms-level&gt;, &lt;charge&gt; Lines starting with # are treated as comments and ignored. The ms-level is usually '1', but you can also use '2' if there are fragment ions commonly occurring.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># lock mass at 574 m/z at MS1 with charge 2</span></div>
<div class="line"><span class="preprocessor">574.345, 1, 2</span></div>
</div><!-- fragment --><p>Additional filters ('cal:lock_require_mono', 'cal:lock_require_iso') allow to exclude spurious false-positive calibrant peaks. These filters require knowledge of the charge state, thus charge needs to be specified in the input CSV. Detailed information on which lock masses passed these filters are available when -debug is used (any level).</p>
<p>The calibration function will use all lock masses (i.e. from all ms-levels) within the defined RT range to calibrate a spectrum. Thus, care should be taken that spectra from ms-levels specified here, are recorded using the same mass analyzer (MA). This is no issue for a Q-Exactive (which only has one MA), but depends on the acquisition scheme for instruments with two/three MAs (e.g. for Orbitrap Velos, MS/MS spectra are commonly acquired in the ion trap and should not be used during calibration of MS1).</p>
<p>General remarks: The user can select what MS levels are subjected to calibration. Calibration must be done once for each mass analyzer. Usually, peptide ID's provide calibration points for MS1 precursors, i.e. are suitable for MS1. They are applicable for MS2 only if the same mass analyzer was used (e.g. Q-Exactive). In other words, MS/MS spectra acquired using the ion trap analyzer of a Velos cannot be calibrated using peptide ID's. Precursor m/z associated to higher-level MS spectra are corrected if their precursor spectra are subject to calibration, e.g. precursor information within MS2 spectra is calibrated if target ms-level is set to 1. Lock masses ('cal:lock_in') can be specified freely for MS1 and/or MS2.</p>
<dl class="section note"><dt>Note</dt><dd>The tool assumes the input data is already picked/centroided.</dd>
<dd>
Currently mzIdentML (mzid) is not directly supported as an input/output format of this tool. Convert mzid files to/from idXML using <a class="el" href="a16291.html">IDFileConverter</a> if necessary.</dd></dl>
<p><b>The command line parameters of this tool are:</b> </p><pre class="fragment">

InternalCalibration -- Applies an internal mass recalibration.

Full documentation: http://www.openms.de/documentation/TOPP_InternalCalibration.html

Version: 2.4.0-HEAD-2019-12-09 Dec  9 2019, 13:47:09, Revision: af8a11e

To cite OpenMS:

  Rost HL, Sachsenberg T, Aiche S, Bielow C et al.. OpenMS: a flexible open-source software platform for mass spectrometry data analysis. Nat Meth. 2016; 13, 9: 741-748. doi:10.1038/nmeth.3959.



Usage:

  InternalCalibration &lt;options&gt;



Options (mandatory options marked with '*'):

  -in &lt;file&gt;*                                Input peak file (valid formats: 'mzML')

  -out &lt;file&gt;*                               Output file  (valid formats: 'mzML')

  -rscript_executable &lt;file&gt;                 Path to the Rscript executable (default: 'Rscript').

                                             

  -ppm_match_tolerance &lt;delta m/z in [ppm]&gt;  Finding calibrants in raw data uses this tolerance (for lock 

                                             masses and ID's). (default: '25.0')



Chose one of two optional input files ('id_in' or 'lock_in') to define the calibration masses/function:

  -cal:id_in &lt;file&gt;                          Identifications or features whose peptide ID's serve as calibrat

                                             ion masses. (valid formats: 'idXML', 'featureXML')

  -cal:lock_in &lt;file&gt;                        Input file containing reference m/z values (text file with each 

                                             line as: m/z ms-level charge) which occur in all scans. (valid

                                             formats: 'csv')

  -cal:lock_out &lt;file&gt;                       Optional output file containing peaks from 'in' which were match

                                             ed to reference m/z values. Useful to see which peaks were used

                                             for calibration. (valid formats: 'mzML')

  -cal:lock_fail_out &lt;file&gt;                  Optional output file containing lock masses which were NOT found

                                             or accepted(!) in data from 'in'. Useful to see which peaks

                                             were used for calibration. (valid formats: 'mzML')

  -cal:lock_require_mono                     Require all lock masses to be monoisotopic, i.e. not the iso1, 

                                             iso2 etc ('charge' column is used to determine the spacing).

                                             Peaks which are not mono-isotopic are not used.

  -cal:lock_require_iso                      Require all lock masses to have at least the +1 isotope. Peaks 

                                             without isotope pattern are not used.

  -cal:model_type &lt;model&gt;                    Type of function to be fitted to the calibration points. (defaul

                                             t: 'linear_weighted' valid: 'linear', 'linear_weighted', 'quadra

                                             tic', 'quadratic_weighted')



                                             

  -ms_level i j ...                          Target MS levels to apply the transformation onto. Does not affe

                                             ct calibrant collection. (default: '[1 2 3]')

  -RT_chunking &lt;RT window in [sec]&gt;          RT window (one-sided, i.e. left-&gt;center, or center-&gt;right) aroun

                                             d an MS scan in which calibrants are collected to build a model.

                                             Set to -1 to use ALL calibrants for all scans, i.e. a global

                                             model. (default: '300.0')



Robust outlier removal using RANSAC:

  -RANSAC:enabled                            Apply RANSAC to calibration points to remove outliers before 

                                             fitting a model.

  -RANSAC:threshold &lt;threshold&gt;              Threshold for accepting inliers (instrument precision (not accur

                                             acy!) as ppm^2 distance) (default: '10.0')

  -RANSAC:pc_inliers &lt;# inliers&gt;             Minimum percentage (of available data) of inliers (&lt;threshold 

                                             away from model) to accept the model. (default: '30' min: '1'

                                             max: '99')

  -RANSAC:iter &lt;# iterations&gt;                Maximal # iterations. (default: '70')



Thresholds for accepting calibration success:

  -goodness:median &lt;threshold&gt;               The median ppm error of calibrated masses must be smaller than 

                                             this threshold. (default: '4.0')

  -goodness:MAD &lt;threshold&gt;                  The median absolute deviation of the ppm error of calibrated 

                                             masses must be smaller than this threshold. (default: '2.0')



Tables and plots to verify calibration performance:

  -quality_control:models &lt;table&gt;            Table of model parameters for each spectrum. (valid formats: 

                                             'csv')

  -quality_control:models_plot &lt;image&gt;       Plot image of model parameters for each spectrum. (valid formats

                                             : 'png')

  -quality_control:residuals &lt;table&gt;         Table of pre- and post calibration errors. (valid formats: 'csv'

                                             )

  -quality_control:residuals_plot &lt;image&gt;    Plot image of pre- and post calibration errors. (valid formats: 

                                             'png')



                                             

Common TOPP options:

  -ini &lt;file&gt;                                Use the given TOPP INI file

  -threads &lt;n&gt;                               Sets the number of threads allowed to be used by the TOPP tool 

                                             (default: '1')

  -write_ini &lt;file&gt;                          Writes the default configuration file

  --help                                     Shows options

  --helphelp                                 Shows all options (including advanced)



</pre><p> <b>INI file documentation of this tool:</b> <div class="ini_global">
<div class="legend">
<b>Legend:</b><br>
 <div class="item item_required">required parameter</div>
 <div class="item item_advanced">advanced parameter</div>
</div>
  <div class="node"><span class="node_name">+InternalCalibration</span><span class="node_description">Applies an internal mass recalibration.</span></div>
    <div class="item item_advanced"><span class="item_name" style="padding-left:16px;">version</span><span class="item_value">2.4.0-HEAD-2019-12-09</span>
<span class="item_description">Version of the tool that generated this parameters file.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>    <div class="node"><span class="node_name">++1</span><span class="node_description">Instance '1' section for 'InternalCalibration'</span></div>
      <div class="item"><span class="item_name item_required" style="padding-left:24px;">in</span><span class="item_value"></span>
<span class="item_description">Input peak file</span><span class="item_tags">input file</span><span class="item_restrictions">*.mzML</span></div>      <div class="item"><span class="item_name item_required" style="padding-left:24px;">out</span><span class="item_value"></span>
<span class="item_description">Output file </span><span class="item_tags">output file</span><span class="item_restrictions">*.mzML</span></div>      <div class="item"><span class="item_name" style="padding-left:24px;">rscript_executable</span><span class="item_value">Rscript</span>
<span class="item_description">Path to the Rscript executable (default: 'Rscript').</span><span class="item_tags">input file</span><span class="item_restrictions"> </span></div>      <div class="item"><span class="item_name" style="padding-left:24px;">ppm_match_tolerance</span><span class="item_value">25.0</span>
<span class="item_description">Finding calibrants in raw data uses this tolerance (for lock masses and ID's).</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item"><span class="item_name" style="padding-left:24px;">ms_level</span><span class="item_value">[1, 2, 3]</span>
<span class="item_description">Target MS levels to apply the transformation onto. Does not affect calibrant collection.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item"><span class="item_name" style="padding-left:24px;">RT_chunking</span><span class="item_value">300.0</span>
<span class="item_description">RT window (one-sided, i.e. left->center, or center->right) around an MS scan in which calibrants are collected to build a model. Set to -1 to use ALL calibrants for all scans, i.e. a global model.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item item_advanced"><span class="item_name" style="padding-left:24px;">log</span><span class="item_value"></span>
<span class="item_description">Name of log file (created only when specified)</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item item_advanced"><span class="item_name" style="padding-left:24px;">debug</span><span class="item_value">0</span>
<span class="item_description">Sets the debug level</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item"><span class="item_name" style="padding-left:24px;">threads</span><span class="item_value">1</span>
<span class="item_description">Sets the number of threads allowed to be used by the TOPP tool</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="item item_advanced"><span class="item_name" style="padding-left:24px;">no_progress</span><span class="item_value">false</span>
<span class="item_description">Disables progress logging to command line</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>      <div class="item item_advanced"><span class="item_name" style="padding-left:24px;">force</span><span class="item_value">false</span>
<span class="item_description">Overwrite tool specific checks.</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>      <div class="item item_advanced"><span class="item_name" style="padding-left:24px;">test</span><span class="item_value">false</span>
<span class="item_description">Enables the test mode (needed for internal use only)</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>      <div class="node"><span class="node_name">+++cal</span><span class="node_description">Chose one of two optional input files ('id_in' or 'lock_in') to define the calibration masses/function</span></div>
        <div class="item"><span class="item_name" style="padding-left:32px;">id_in</span><span class="item_value"></span>
<span class="item_description">Identifications or features whose peptide ID's serve as calibration masses.</span><span class="item_tags">input file</span><span class="item_restrictions">*.idXML,*.featureXML</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">lock_in</span><span class="item_value"></span>
<span class="item_description">Input file containing reference m/z values (text file with each line as: m/z ms-level charge) which occur in all scans.</span><span class="item_tags">input file</span><span class="item_restrictions">*.csv</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">lock_out</span><span class="item_value"></span>
<span class="item_description">Optional output file containing peaks from 'in' which were matched to reference m/z values. Useful to see which peaks were used for calibration.</span><span class="item_tags">output file</span><span class="item_restrictions">*.mzML</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">lock_fail_out</span><span class="item_value"></span>
<span class="item_description">Optional output file containing lock masses which were NOT found or accepted(!) in data from 'in'. Useful to see which peaks were used for calibration.</span><span class="item_tags">output file</span><span class="item_restrictions">*.mzML</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">lock_require_mono</span><span class="item_value">false</span>
<span class="item_description">Require all lock masses to be monoisotopic, i.e. not the iso1, iso2 etc ('charge' column is used to determine the spacing). Peaks which are not mono-isotopic are not used.</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">lock_require_iso</span><span class="item_value">false</span>
<span class="item_description">Require all lock masses to have at least the +1 isotope. Peaks without isotope pattern are not used.</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">model_type</span><span class="item_value">linear_weighted</span>
<span class="item_description">Type of function to be fitted to the calibration points.</span><span class="item_tags"></span><span class="item_restrictions">linear,linear_weighted,quadratic,quadratic_weighted</span></div>      <div class="node"><span class="node_name">+++RANSAC</span><span class="node_description">Robust outlier removal using RANSAC</span></div>
        <div class="item"><span class="item_name" style="padding-left:32px;">enabled</span><span class="item_value">false</span>
<span class="item_description">Apply RANSAC to calibration points to remove outliers before fitting a model.</span><span class="item_tags"></span><span class="item_restrictions">true,false</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">threshold</span><span class="item_value">10.0</span>
<span class="item_description">Threshold for accepting inliers (instrument precision (not accuracy!) as ppm^2 distance)</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">pc_inliers</span><span class="item_value">30</span>
<span class="item_description">Minimum percentage (of available data) of inliers (<threshold away from model) to accept the model.</span><span class="item_tags"></span><span class="item_restrictions">1:99</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">iter</span><span class="item_value">70</span>
<span class="item_description">Maximal # iterations.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="node"><span class="node_name">+++goodness</span><span class="node_description">Thresholds for accepting calibration success</span></div>
        <div class="item"><span class="item_name" style="padding-left:32px;">median</span><span class="item_value">4.0</span>
<span class="item_description">The median ppm error of calibrated masses must be smaller than this threshold.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">MAD</span><span class="item_value">2.0</span>
<span class="item_description">The median absolute deviation of the ppm error of calibrated masses must be smaller than this threshold.</span><span class="item_tags"></span><span class="item_restrictions"> </span></div>      <div class="node"><span class="node_name">+++quality_control</span><span class="node_description">Tables and plots to verify calibration performance</span></div>
        <div class="item"><span class="item_name" style="padding-left:32px;">models</span><span class="item_value"></span>
<span class="item_description">Table of model parameters for each spectrum.</span><span class="item_tags">output file</span><span class="item_restrictions">*.csv</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">models_plot</span><span class="item_value"></span>
<span class="item_description">Plot image of model parameters for each spectrum.</span><span class="item_tags">output file</span><span class="item_restrictions">*.png</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">residuals</span><span class="item_value"></span>
<span class="item_description">Table of pre- and post calibration errors.</span><span class="item_tags">output file</span><span class="item_restrictions">*.csv</span></div>        <div class="item"><span class="item_name" style="padding-left:32px;">residuals_plot</span><span class="item_value"></span>
<span class="item_description">Plot image of pre- and post calibration errors.</span><span class="item_tags">output file</span><span class="item_restrictions">*.png</span></div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 9 2019 15:06:28 for OpenMS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
